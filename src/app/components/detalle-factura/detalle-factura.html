<div class="container mt-4" *ngIf="!cargando && !error && factura">
  <div class="card shadow mb-4 border-primary">
    <!-- Cabecera -->
    <div class="card-header bg-primary text-white py-3">
      <h2 class="mb-0">Detalle de Factura</h2>
    </div>
    
    <div class="card-body">
      <!-- Número de factura y fecha -->
      <div class="row mb-4">
        <div class="col-md-6">
          <h4 class="text-primary">Factura #{{Factura.numero}}</h4>
        </div>
        <div class="col-md-6 text-md-end">
          <span class="badge bg-info fs-6">
            {{Factura.fechaEmision | date:'dd/MM/yyyy'}}
          </span>
        </div>
      </div>

      <!-- Datos del proveedor -->
      <div class="row mb-4">
        <div class="col-md-4 mb-3 mb-md-0">
          <div class="fw-bold text-primary">Proveedor</div>
          <div>{{Factura.proveedor}}</div>
        </div>
        <div class="col-md-4 mb-3 mb-md-0">
          <div class="fw-bold text-primary">RUC</div>
          <div>{{Factura.ruc}}</div>
        </div>
        <div class="col-md-4">
          <div class="fw-bold text-primary">Fecha de Emisión</div>
          <div>{{Factura.fechaEmision | date:'dd/MM/yyyy'}}</div>
        </div>
      </div>

      <!-- Tabla de items -->
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unitario</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of factura.productos">
              <td>{{item.nombre}}</td>
              <td>{{item.cantidad}}</td>
              <td>{{formatearMoneda(item.precioUnitario)}}</td>
              <td>{{formatearMoneda(item.subtotal)}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Totales -->
      <div class="row mt-4">
        <div class="col-md-4 offset-md-8">
          <table class="table table-bordered">
            <tr>
              <td class="fw-bold bg-light">Subtotal</td>
              <td class="text-end">{{formatearMoneda(Factura.subtotal)}}</td>
            </tr>
            <tr>
              <td class="fw-bold bg-light">IVA (12%)</td>
              <td class="text-end">{{formatearMoneda(Factura.iva)}}</td>
            </tr>
            <tr class="table-success">
              <td class="fw-bold">Total</td>
              <td class="text-end fw-bold">{{formatearMoneda(Factura.total)}}</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- Sección JSON -->
      <div class="card mt-4 border-info">
        <div class="card-header bg-info text-white py-2">
          <h5 class="mb-0">Datos Estructurados (JSON)</h5>
        </div>
        <div class="card-body p-0">
          <pre class="m-0 p-3 bg-dark text-light rounded">{{Factura | json}}</pre>
        </div>
      </div>

      <!-- Resumen IA -->
      <div class="card mt-4 border-warning" *ngIf="factura.resumen">
        <div class="card-header bg-warning text-dark py-2">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Resumen Generado por IA</h5>
            <div>
              <button *ngIf="!reproduciendoAudio" class="btn btn-sm btn-outline-dark me-2" 
                      (click)="reproducirResumen()">
                <i class="bi bi-play-circle me-1"></i> Escuchar
              </button>
              <button *ngIf="reproduciendoAudio" class="btn btn-sm btn-outline-danger" 
                      (click)="detenerAudio()">
                <i class="bi bi-stop-circle me-1"></i> Detener
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <p class="fst-italic">{{Factura.resumen}}</p>
          <div class="text-muted small mt-2" *ngIf="factura.modeloIA && factura.fechaGeneracion">
            Modelo: {{Factura.modeloIA}} | Generado: {{Factura.fechaGeneracion | date:'dd/MM/yyyy HH:mm'}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Estados de carga y error (mantener igual) -->